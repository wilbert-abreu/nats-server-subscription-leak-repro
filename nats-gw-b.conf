# NATS Server Configuration - Cluster B with Gateway

port: 4222
http_port: 8222

max_connections: 64000
max_pending: 32MB
max_payload: 10MB
write_deadline: 10s

cluster {
  name: cluster-b
  port: 6222
  no_advertise: true
}

gateway {
  name: cluster-b
  port: 7222
  reject_unknown_cluster: true
  gateways: [
    { name: cluster-a, urls: ["nats://nats-0:7222", "nats://nats-1:7222", "nats://nats-2:7222", "nats://nats-3:7222", "nats://nats-4:7222"] }
  ]
}

leafnodes {
  port: 7422
}

jetstream {
  store_dir: /data/jetstream
  domain: hub
  max_mem: 1G
  max_file: 10G
}

debug: false
trace: false
logtime: true

lame_duck_grace_period: 30s
lame_duck_duration: 120s

accounts {
  SYS: {
    users: [
      { user: admin, password: admin }
    ]
  }
  
  # Aggregate account - imports from zone accounts
  ACC: {
    jetstream: enabled
    users: [
      { user: acc, password: acc }
      { user: readonly, permissions: {
          publish: { allow: ["$JS.API.>", "$JS.ACK.>"], deny: ["$JS.API.STREAM.CREATE.>", "$JS.API.STREAM.UPDATE.>", "$JS.API.STREAM.DELETE.>"] }
          subscribe: { allow: [">", "_INBOX.>"] }
        }
      }
    ]
    exports: [
      { service: "$JS.API.>" }
      { service: "$JS.hub.>" }
      { stream: ">" }
    ]
    imports: [
      { stream: { account: zone1, subject: ">" } }
      { stream: { account: zone2, subject: ">" } }
      { stream: { account: zone3, subject: ">" } }
    ]
  }
  
  # Zone accounts - leaf nodes connect with these credentials
  zone1: {
    jetstream: enabled
    users: [
      { user: zone1, password: zone }
    ]
    exports: [
      { service: "$JS.API.>" }
      { service: "$JS.hub.>" }
      { stream: ">" }
    ]
  }
  
  zone2: {
    jetstream: enabled
    users: [
      { user: zone2, password: zone }
    ]
    exports: [
      { service: "$JS.API.>" }
      { service: "$JS.hub.>" }
      { stream: ">" }
    ]
  }
  
  zone3: {
    jetstream: enabled
    users: [
      { user: zone3, password: zone }
    ]
    exports: [
      { service: "$JS.API.>" }
      { service: "$JS.hub.>" }
      { stream: ">" }
    ]
  }
}

system_account: SYS
no_auth_user: readonly
